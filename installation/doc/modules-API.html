<HTML>
<HEAD>
<TITLE>Installer YCP modules API documentation</TITLE>
</HEAD>
<BODY>

<H1>Installer YCP modules API documentation</H1>
This document describes a general API for the installation
modules.<BR>
It does not define strict rules, but some hints and reasoning
for module implementors.<BR>
<BR>
<P></P>
A module should be written like a class in an object oriented
design. It should keep most information internally and only
reveal the functionality, not the implementation.<BR>
<BR>
<H2>Persistent data</H2>
For persistent information, the module must be able to save
and restore it's internal state.<BR>
This state information should be kept to a minimum. Do not save
computable data, re-compute the data from its basic components
instead.<BR>
<H2>/etc/sysconfig</H2>
Try to use a file in <tt>/etc/sysconfig</tt> for the persistent
data. Only use YaST2 specific files, if the information is
YaST2 specific and can't be re-generated from the sysconfig
file.<BR>
<H2>Constructor</H2>
<A name="Constructor"></A>
The constructor should set the module to a defined state.<BR>
For modules with persistent data, this data should be re-generated
in the constructor. Do *not* call functions in the constructor
which might require user-interaction (i.e. loading of kernel
modules, since it must be confirmed in 'manual mode') or which
need too much time (like loading of scsi modules, this can
take up to 10 seconds !). If such functions are needed, put
them in a 'Probe' or 'Init' function and document it.<BR>
<BR>See the <A HREF="autodocs/Mouse.html">Mouse module</A> as
an example.<BR>
<H3>Special case: Configuration System for AutoYaST2</H3>
Some modules are now being re-used in the configuration system
used to create control files for auto-installation.
<br>
To avoid probing and reading data from the running system when 
configuring a control file for different system, please use 
the config mode: <b>Mode::config</b>.
<H2>API functions</H2>
In order to distinguish between global and module-local functions,
all global functions and variables start with an upper-case letter.<BR>
Ideally, all functions should work with consistent syntactic and
semantic values. For example, all external language data is based
on the ISO codes ("de_DE", "en_US", etc.).
<H3>Check</H3>
<A name="Check"></A>
If the module state depends on (configurations of) other modules,
a re-configuration might be needed.<BR>
The Check function takes care of such dependencies and returns
<tt>1</tt> if the re-configuration changed the internal state
previously defined by <A HREF="#Set">Set</A>.<BR>
If the configuration is unchanged, <tt>Check</tt> should return 0.<BR>
<BR>
There's no need to return true if the previous state was automatically
defined (either by the <A HREF="#Constructor">Constructor</A> or
by <A HREF="#Probe">probing</A>). It's only needed to inform the
user who manually defined the configuration.<BR>
<BR>
The <tt>Check</tt> function should also determine if the current
configuration is consistent and return 2 if it's not. E.g. the package
selection depends on partitioning and requires user interaction
if the partition is too small for the packages.<BR>
<H3>Selection</H3>
<A name="Selection"></A>
The <tt>Selection</tt> function is used to build up a selection
list for the user. Therefore, it should contain translated, user-readable
strings.<BR>
A good approach is to return a map, where the key is an (internal) identifier
and the value is the translated string.<BR>
Other solutions are possible, see the <A HREF="autodocs/Language.html">
Language module</A>.
<H3>Set</H3>
<A name="Set"></A>
The <TT>Set</TT> function effectively changes the running system according
to the parameter passed. It does not change any configuration files,
this is done with the <tt>Save</tt> function.
<H3>Probe</H3>
<A name="Probe"></A>
If the constructor can't do any probing (see <A HREF="#Constructor">Constructor</A> above),
a separate probing function should be supplied.<BR>
This is done in the <A HREF="autodocs/Mouse.html">Mouse</A> module since
USB mice required some additional kernel modules.<BR>
<H3>Save</H3>
<A name="Save"></A>
The Save function stores the current configuration (defined by the
last call to <A HREF="#Set">Set</A>) to the system.<BR>
If possible, an appropriate file below <tt>/etc/sysconfig</tt> should be used.<BR>
If unsure, login to <tt>redhat.suse.de</tt> or ask on
<A HREF="mailto:yast2-hacker@suse.de">yast2-hacker</A>.<BR>
<BR>
<P></P>
<HR>
<smaller>Last changed 13-12-2001 11:21</smaller><br>
<smaller>Written by <A HREF="mailto:kkaempf@suse.de">Klaus K&auml;mpf</A></smaller><br>
</BODY>
</HTML>
